<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="initial-scale=1" name="viewport" /><title>Padrino - The Elegant Ruby Web Framework</title><link href="/assets/favicon.ico" rel="icon" type="image/ico" /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" /><link href="../../../assets/stylesheets/style-75d468d0.css" rel="stylesheet" /></head><body class="blog blog_page blog_page_11 blog_page_11_index"><div class="grid"><header class="header"><h1 class="header__name"><a class="padrino-name" href="/">Padrino</a></h1><div class="header__navigation"><nav class="navigation"><a class="navigation__toggler" href="#" id="navigation__toggler"><span class="navigation__toggler__icon fa fa-navicon"></span></a><ul class="navigation__items" id="navigation__items"><li class="navigation__item"><a class="navigation__link" href="/">Overview</a></li><li class="navigation__item"><a class="navigation__link" href="/guides/">Guides</a></li><li class="navigation__item"><a class="navigation__link--is-active" href="/blog/">Blog</a></li><li class="navigation__item"><a class="navigation__link" href="http://www.rubydoc.info/github/padrino/padrino-framework">API</a></li><li class="navigation__item"><a class="navigation__link" href="/contribute/">Contribute</a></li><li class="navigation__item"><a class="navigation__link" href="https://github.com/padrino/padrino-framework"><span class="button--slim">GitHub</span></a></li></ul></nav></div></header><div class="page"><div class="page__sidebar"><div class="sidebar"><h4 class="sidebar__header--first">Blog</h4><h5 class="sidebar__header">Latest Posts</h5><ul class="sidebar__items"><li class="sidebar__item"><a class="sidebar__link" href="/blog/upgrading-padrino-from-0-12-x-to-0-13-0-guide/">Upgrading Padrino from 0.12.X to 0.13.0 Guide</a></li><li class="sidebar__item"><a class="sidebar__link" href="/blog/padrino-0-13-0-mustermann-router-performance-enhancements-streaming-support-and-much-more/">Padrino 0.13.0 - Mustermann Router, Performance Enhancements, Streaming Support, and Much More</a></li><li class="sidebar__item"><a class="sidebar__link" href="/blog/padrino-0-12-5/">Padrino 0.12.5</a></li><li class="sidebar__item"><a class="sidebar__link" href="/blog/padrino-0-12-4/">Padrino 0.12.4</a></li><li class="sidebar__item"><a class="sidebar__link" href="/blog/padrino-0-11-0-released-padrino-lives/">Padrino 0.11.0 Released - Padrino Lives!</a></li><li class="sidebar__item"><a class="sidebar__link" href="/blog/json-gem-vulnerability/">JSON gem vulnerability</a></li><li class="sidebar__item"><a class="sidebar__link" href="/blog/upgrade-rack-immediately/">Upgrade Rack immediately</a></li></ul></div></div><div class="page__content"><div class="content"><div class="article"><h1 class="article__title"><a href="/blog/padrino-0-9-28-reloader-compatibility-and-bug-fixes/">Padrino 0.9.28 - Reloader, Compatibility and Bug Fixes</a></h1><p class="article__metadata">Posted on May 11, 2011 by Nathan</p><p>Today we released another minor, iterative point release that addresses a few issues including development reloader hanging, couch_rest compatibility, mongoid system_timer deps, and easier Rakefile generation. For more details see the rest of this post. This release should not have any breaking changes whatsoever, so please upgrade as soon as you can.</p>

<p>Stay tuned for 0.9.29 and then the big 0.10.0 release coinciding with the release of Sinatra 1.3.</p>

<p>Two very small additions:</p>

<ul>
  <li>Added an alias to <code>padrino start</code> as <code>padrino s</code> for convenience <a href="https://github.com/padrino/padrino-framework/commit/ef47900afffc1ff0743fc3aa723639efd4975d06">here</a></li>
  <li>Added an easy way to generate a Rakefile <a href="https://github.com/padrino/padrino-framework/commit/81e54b116d54ee791ccd44e7156ee4156f16034c">here</a>. This allows you to stop using <code>padrino rake</code> and use <code>rake</code> directly. Especially useful for Heroku deployed apps! Simply run <code>$ padrino rake gen</code>.</li>
</ul>

<p>Th is a simple bugfix release with these being the major fixes:</p>

<ul>
  <li>Development reloader hangs during reload fixed <a href="https://github.com/padrino/padrino-framework/commit/054c2795600d2ce7e220dd1cef2cbe2755b273d2">here</a></li>
  <li>Updated couch_rest models and dependencies <a href="https://github.com/padrino/padrino-framework/commit/d6d053965511fb170cf5befc89bbeeefa7cd24e9">here</a> and <a href="https://github.com/padrino/padrino-framework/commit/a836741cf6017ae955f90d44a743c4a0b226e1d7">here</a></li>
  <li>Fixed mongoid and mongomapper deps <a href="https://github.com/padrino/padrino-framework/commit/e5cff99646e50b6f44d1bb7b07e63090a688b551">here</a> and <a href="https://github.com/padrino/padrino-framework/commit/ff320862bfbf76ff3c46e70aa519672039ad1604">here</a>. Thanks to RoryO for the pull request.</li>
</ul>

<hr /></div><div class="article"><h1 class="article__title"><a href="/blog/padrino-and-omniauth-overview/">Padrino and OmniAuth Overview</a></h1><p class="article__metadata">Posted on May 10, 2011 by DAddYE</p><p>In this post, we will show you how to mix our <a href="https://github.com/padrino/padrino-framework/blob/master/padrino-admin/lib/padrino-admin/access_control.rb">Access Control</a> described <a href="/guides/padrino-admin#admin-authentication">here</a> with the beautiful <a href="https://github.com/intridea/omniauth">omniauth</a> rack middleware.</p>

<p>The Padrino admin authentication and access control system provides a simple foundation from which you can create your authentication system. Combined with <a href="https://github.com/intridea/omniauth">omniauth</a> you can then easily leverage the system to allow authentication through a variety of methods. Read below for more details on how to integrate them.</p>

<break>

In this article we’ll cover two topics:

1) Integrating Padrino Admin Authentication into all apps within your project
 2) Enabling custom authentication strategies within the authentication system

Before we begin, it is important to note that our integrated authentication based on project-roles can interact easily with other systems. The only files that need to be changed are `session.rb` and `account.rb` in order to add your own custom code.

So, let’s start by creating a project using activerecord:

    $ padrino g project foo --orm activerecord --tiny
    $ cd foo
    $ bundle install

Now we need to add a model called `Account` to act as our persistence model:

    $ padrino g model Account name:string email:string role:string uid:string provider:string

||
|name|the name of the account|
|email|the email of the account|
|role|the access control role|
|uid|omniauth uid|
|provider|omniauth provider|

Now we need to create and migrate our database:

    $ padrino rake ar:create ar:migrate

Open your favorite editor and browse and edit `Gemfile` and add `omniauth` gem and the providers for twitter and facebook.
We also add the `haml` gem as it's not included by default in the "tiny" padrino template:

    # Gemfile
    gem 'omniauth'
    gem 'omniauth-twitter'
    gem 'omniauth-facebook'
    gem 'haml'

Now, run bundle install to install dependencies:

    $ bundle install

Now we need to add the `omniauth middleware`. Here you can choose two ways:

1) Add the middleware project-wide (so every subapp can use it)
 2) Add the middleware only to the one app that requires it

In our example, we need to edit simply `app/app.rb` and add:

    # app/app.rb
    use OmniAuth::Builder do
      provider :twitter,  'consumer_key', 'consumer_secret'
      provider :facebook, 'app_id', 'app_secret'
    end

If you are in a multiapp scenario you need to edit `config/boot.rb`:

    # config/boot.rb
    Padrino.use OmniAuth::Builder do
      provider :twitter,  'consumer_key', 'consumer_secret'
      provider :facebook, 'app_id', 'app_secret'
    end

    # before the line
    Padrino.load!

To obtain an app\_id and secret for Facebook, you need to:

- Go to the [Facebook Developers Page](http://www.facebook.com/developers)
- Browse and click [create a new app](http://www.facebook.com/developers/createapp.php)
- Set your app name and complete the form…
- One you finish that you are allowed to edit your settings, go to **website** section
- Add to site url: `http://localhost:3000`
- Add to domain: `localhost`
- Write the **Application ID** and **Application Secret** to the `OmniAuth::Builder`

To obtain a consumer\_key and consumer\_secret for Twitter, you need to:

- Go to [Twitter Applications Page](https://developer.twitter.com/apps/new)
- Insert all details and be sure to check **Application Type: Browser**
- Set a callback url with a valid domain ex: `www.mydomain.com/auth/twitter/callback`
- Save and go to **Application Settings** and **Manage Domains**
- Be sure that you can see your example domain: `www.mydomain.com/auth/twitter/callback`
- Authorize domain: `localhost`
- Now go to **Application Details** and save `Consumer key` and `Consumer Secret` to the `OmniAuth::Builder`

**NOTE**: For domain, it is not important that this path exist because `omniauth` changes the callback url.

Next, we can integrate our authentication system within in `app/app.rb`:

    # app/app.rb
    # at the top before the class definition
    register Padrino::Admin::AccessControl

    set :login_page, "/" # determines the url login occurs

    access_control.roles_for :any do |role|
      role.protect "/profile"
      role.protect "/admin" # here is a demo path
    end

    # now we add a role for users
    access_control.roles_for :users do |role|
      role.allow "/profile"
    end

And add a couple useful routes, edit `app/controllers.rb` with:

    # app/controllers.rb
    get :index do
      haml &lt;&lt;-HAML.gsub(/^ {6}/, '')
        Login with
        =link_to('Facebook', '/auth/facebook')
        or
        =link_to('Twitter',  '/auth/twitter')
      HAML
    end

    get :profile do
      content_type :text
      current_account.to_yaml
    end

    get :destroy do
      set_current_account(nil)
      redirect url(:index)
    end

    get :auth, :map =&gt; '/auth/:provider/callback' do
      auth    = request.env["omniauth.auth"]
      account = Account.find_by_provider_and_uid(auth["provider"], auth["uid"]) ||
                Account.create_with_omniauth(auth)
      set_current_account(account)
      redirect "http://" + request.env["HTTP_HOST"] + url(:profile)
    end

We invoked a method `Account.create_with_omniauth` above, so edit `app/models/account.rb` and add:

    # app/models/account.rb
    def self.create_with_omniauth(auth)
      create! do |account|
        account.provider = auth["provider"]
        account.uid      = auth["uid"]
        account.email    = auth["name"]
        account.email    = auth["user_info"]["email"] if auth["user_info"] # we get this only from FB
        account.role     = "users"
      end
    end

That should just about do it! Let’s start the server:

    $ padrino start

Browse &lt;http://localhost:3000/profile&gt;

That will kickoff to the login\_page, in our case `/`.

Now you can login here &lt;http://localhost:3000&gt;

Follow your login process and then if needed &lt;http://localhost:3000/destroy&gt;

That is all you need to setup a barebones authentication system in Padrino. This post has gotten you started with a working “Account” and role based authentication solution with integrated omniauth support. From here, obviously there are a number of other features you might want to add on top to flesh out, and that is left for another post or as an exercise to the reader.

If you are interested in more Padrino information, check out [why you should use](http://www.padrinorb.com/pages/why) our framework and our [Blog Tutorial](http://www.padrinorb.com/guides/blog-tutorial) along with our other [Padrino Guides](http://www.padrinorb.com/guides).

</break>
<hr /></div><li><a href="/blog/page/10/">Prev Page</a></li><li><a href="/blog/page/12/">Next Page</a></li></div></div></div><hr /><footer class="footer"><p>Padrino is released under the MIT LICENSE<br />
Hosting by <a href="https://pages.github.com">GitHub Pages</a></p>
</footer><script src="../../../assets/javascripts/all-c2e0cecd.js"></script></div></body></html>