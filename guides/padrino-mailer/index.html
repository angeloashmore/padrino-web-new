<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="initial-scale=1" name="viewport" /><title>Padrino - Padrino Mailer</title><link href="/assets/favicon.ico" rel="icon" type="image/ico" /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" /><link href="../../assets/stylesheets/style-75d468d0.css" rel="stylesheet" /></head><body class="guides guides_padrino-mailer guides_padrino-mailer_index"><div class="grid"><header class="header"><h1 class="header__name"><a class="padrino-name" href="/">Padrino</a></h1><div class="header__navigation"><nav class="navigation"><a class="navigation__toggler" href="#" id="navigation__toggler"><span class="navigation__toggler__icon fa fa-navicon"></span></a><ul class="navigation__items" id="navigation__items"><li class="navigation__item"><a class="navigation__link" href="/">Overview</a></li><li class="navigation__item"><a class="navigation__link--is-active" href="/guides/">Guides</a></li><li class="navigation__item"><a class="navigation__link" href="/blog/">Blog</a></li><li class="navigation__item"><a class="navigation__link" href="http://www.rubydoc.info/github/padrino/padrino-framework">API</a></li><li class="navigation__item"><a class="navigation__link" href="/contribute/">Contribute</a></li><li class="navigation__item"><a class="navigation__link" href="https://github.com/padrino/padrino-framework"><span class="button--slim">GitHub</span></a></li></ul></nav></div></header><div class="page"><div class="page__sidebar"><div class="sidebar"><h4 class="sidebar__header--first">Guides</h4><ul class="sidebar__items"><li class="sidebar__item"><a class="sidebar__link" href="/guides/">Home</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/getting-started/">Getting Started</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/installation/">Installation</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/basic-projects/">Basic Projects</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/generators/">Generators</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/development-commands/">Development Commands</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/mounting-applications/">Mounting Applications</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/blog-tutorial/">Blog Tutorial</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/application-helpers/">Application Helpers</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/padrino-admin/">Padrino Admin</a></li><li class="sidebar__item"><a class="sidebar__link--is-active" href="/guides/padrino-mailer/">Padrino Mailer</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/padrino-cache/">Padrino Cache</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/controllers/">Controllers</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/localization/">Localization</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/extensions/">Extensions</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/rake-tasks/">Rake Tasks</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/the-bleeding-edge/">The Bleeding Edge</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/adding-new-components/">Adding New Components</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/standalone-usage-in-sinatra/">Standalone Usage in Sinatra</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/running-padrino-on-jruby/">Running Padrino on JRuby</a></li></ul></div></div><div class="page__content"><div class="content"><h1 id="padrino-mailer">Padrino Mailer</h1>

<p>This component creates an easy and intuitive interface for delivering email
within a Sinatra application. The <a href="http://github.com/mikel/mail">mail</a> library
is utilized to do the bulk of the work. There is full support for rendering
email templates, using an html content type and for file attachments. The
Padrino Mailer uses a familiar Sinatra syntax similar to that of defining routes
for a controller.</p>

<hr />

<h2 id="configuration">Configuration</h2>

<p>Let’s take a look at using the Mailer in an application. By default, the mailer
uses the built-in sendmail binary on the server. However, smtp is also supported
using the following declaration in your application:</p>

<pre class="highlight ruby"><code><span class="c1"># app/app.rb</span>
<span class="n">set</span> <span class="ss">:delivery_method</span><span class="p">,</span> <span class="ss">:smtp</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="ss">:address</span>              <span class="o">=&gt;</span> <span class="s2">"smtp.gmail.com"</span><span class="p">,</span>
  <span class="ss">:port</span>                 <span class="o">=&gt;</span> <span class="mi">587</span><span class="p">,</span>
  <span class="ss">:user_name</span>            <span class="o">=&gt;</span> <span class="s1">'&lt;username&gt;@gmail.com'</span><span class="p">,</span>
  <span class="ss">:password</span>             <span class="o">=&gt;</span> <span class="s1">'&lt;password&gt;'</span><span class="p">,</span>
  <span class="ss">:authentication</span>       <span class="o">=&gt;</span> <span class="ss">:plain</span><span class="p">,</span>
  <span class="ss">:enable_starttls_auto</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="p">}</span>
</code></pre>

<p>Once those have been defined, the default will become smtp delivery unless
overwritten in an individual mail definition.</p>

<p>You can also configure the mailer to not send emails during development or
testing. This can be done with:</p>

<pre class="highlight ruby"><code><span class="c1"># app/app.rb</span>
<span class="n">set</span> <span class="ss">:delivery_method</span><span class="p">,</span> <span class="ss">:test</span>
</code></pre>

<hr />

<h2 id="quick-usage">Quick Usage</h2>

<p>Padrino supports sending any arbitrary email (using either sendmail or smtp)
right from your controllers. This is ideal for ‘one-off’ emails where the ‘full’
mailer object is simply unnecessary or too heavy for your simple task.</p>

<p>Delivering an email within your controller is simple:</p>

<pre class="highlight ruby"><code><span class="c1"># app/controllers/session.rb</span>
<span class="n">post</span> <span class="ss">:create</span> <span class="k">do</span>
  <span class="n">email</span><span class="p">(</span><span class="ss">:from</span> <span class="o">=&gt;</span> <span class="s2">"tony@reyes.com"</span><span class="p">,</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s2">"john@smith.com"</span><span class="p">,</span> <span class="ss">:subject</span> <span class="o">=&gt;</span> <span class="s2">"Welcome!"</span><span class="p">,</span> <span class="ss">:body</span><span class="o">=&gt;</span><span class="s2">"Body"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<p>This simple helper will accept any of the standard email attributes and deliver
your email in a single command. You can also use a block, render a template for
the body and specify a delivery method:</p>

<pre class="highlight ruby"><code><span class="c1"># app/controllers/session.rb</span>
<span class="n">post</span> <span class="ss">:create</span> <span class="k">do</span>
  <span class="n">email</span> <span class="k">do</span>
    <span class="n">from</span> <span class="s2">"tony@reyes.com"</span>
    <span class="n">to</span> <span class="s2">"john@smith.com"</span>
    <span class="n">subject</span> <span class="s2">"Welcome!"</span>
    <span class="n">body</span> <span class="n">render</span><span class="p">(</span><span class="s1">'email/registered'</span><span class="p">)</span>
    <span class="n">via</span> <span class="ss">:sendmail</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>This is all you need to send simple emails. However, Padrino also supports a
more ‘structured’ mailer system as well.</p>

<hr />

<h2 id="mailer-usage">Mailer Usage</h2>

<p>To use the structured mailer syntax, we should define a custom mailer using the
<code>mailer</code> block:</p>

<pre class="highlight ruby"><code><span class="c1"># app/mailers/sample_mailer.rb</span>
<span class="no">MyAppName</span><span class="p">.</span><span class="nf">mailer</span> <span class="ss">:sample</span> <span class="k">do</span>
  <span class="n">email</span> <span class="ss">:registration_email</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">email</span><span class="o">|</span>
    <span class="n">from</span> <span class="s1">'admin@site.com'</span>
    <span class="n">to</span> <span class="n">email</span>
    <span class="n">subject</span> <span class="s1">'Welcome to the site!'</span>
    <span class="n">locals</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="nb">name</span><span class="p">,</span> <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="n">email</span>
    <span class="n">render</span> <span class="s1">'sample/registration_email'</span>
    <span class="n">content_type</span> <span class="ss">:html</span>       <span class="c1"># optional, defaults to :plain</span>
    <span class="n">via</span> <span class="ss">:sendmail</span>            <span class="c1"># optional, to smtp if defined otherwise sendmail</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Note that this can be created much easier by using the padrino-mailer generator
in the terminal:</p>

<pre class="highlight shell"><code><span class="gp">$ </span>padrino g mailer Sample registration_email
</code></pre>

<p>This mailer defines a mail route called ‘<code>registration_mail</code>’ within the
'<code>sample</code>' mailer. The '<code>registration_email</code>' route accepts the name and email
arguments. Arguments are passed to the email body template via the <code>locals</code>
method. The render command renders the email body template with the local
variables, which should be defined in
<code>[views_path]/mailers/sample/registration_email.erb</code> as shown below:</p>

<pre class="highlight erb"><code># ./views/mailers/sample/registration_email.erb
This is the body of the email and can access the <span class="cp">&lt;%=</span> <span class="nb">name</span> <span class="cp">%&gt;</span> variable.
That's all there is to defining the body of the email which can be in plain text or html.
</code></pre>

<p>Note that the mailer has full support for content type resolution and the email
could also be in the path <code>./views/mailers/sample/registration_email.html.erb</code>
or <code>./views/mailers/sample/registration_email.plain.erb</code> specifying the mime
type in the file name as well.</p>

<p>Once the mailer has been defined and the template written, the email route can
be invoked by the <code>deliver</code> method:</p>

<pre class="highlight ruby"><code><span class="n">deliver</span><span class="p">(</span><span class="ss">:sample</span><span class="p">,</span> <span class="ss">:registration_email</span><span class="p">,</span> <span class="s2">"Bob"</span><span class="p">,</span> <span class="s2">"bob@bobby.com"</span><span class="p">)</span>
</code></pre>

<p>And that will then deliver the email according the the configured options.</p>

<hr />

<h2 id="multipart-emails">Multipart Emails</h2>

<p>The mailer supports multipart emails quite easily:</p>

<pre class="highlight ruby"><code><span class="c1"># app/mailers/sample_mailer.rb</span>
<span class="n">mailer</span> <span class="ss">:sample</span> <span class="k">do</span>
  <span class="n">email</span> <span class="ss">:email_with_parts</span> <span class="k">do</span>
    <span class="n">from</span> <span class="s1">'admin@site.com'</span>
    <span class="c1"># ...</span>
    <span class="n">text_part</span> <span class="p">{</span> <span class="n">render</span><span class="p">(</span><span class="s1">'path/to/basic.text'</span><span class="p">)</span>  <span class="p">}</span>
    <span class="n">html_part</span> <span class="n">render</span><span class="p">(</span><span class="s1">'path/to/basic.html'</span><span class="p">)</span> <span class="c1"># shorter part syntax</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>You can even specify multiple part types using the <code>provides</code> declaration:</p>

<pre class="highlight ruby"><code><span class="c1"># app/mailers/sample_mailer.rb</span>
<span class="n">mailer</span> <span class="ss">:sample</span> <span class="k">do</span>
  <span class="n">email</span> <span class="ss">:email_with_parts</span> <span class="k">do</span>
    <span class="n">from</span> <span class="s1">'admin@site.com'</span>
    <span class="c1"># ...</span>
    <span class="c1"># renders path/to/basic.html.erb and path/to/basic.plain.erb</span>
    <span class="n">provides</span> <span class="ss">:plain</span><span class="p">,</span> <span class="ss">:html</span>
    <span class="n">render</span> <span class="s1">'path/to/basic'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>These will deliver a multipart/alternative email with the appropriate plain text
and html sections.</p>

<hr />

<h2 id="file-attachments">File Attachments</h2>

<p>Using the mailer attaching files to a message is easy:</p>

<pre class="highlight ruby"><code><span class="c1"># app/mailers/sample_mailer.rb</span>
<span class="n">mailer</span> <span class="ss">:sample</span> <span class="k">do</span>
  <span class="n">email</span> <span class="ss">:email_with_files</span> <span class="k">do</span>
    <span class="n">from</span> <span class="s1">'admin@site.com'</span>
    <span class="c1"># ...</span>
    <span class="n">body</span> <span class="s2">"Here are your files!"</span>
    <span class="n">add_file</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">'somefile.png'</span><span class="p">,</span> <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'/somefile.png'</span><span class="p">)</span>
    <span class="n">add_file</span> <span class="s1">'/full/path/to/someotherfile.png'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>This will deliver your email with the appropriate body and the specified files
attached.</p>

<hr />

<h2 id="defaults">Defaults</h2>

<p>To define mailer defaults for a message, we can do so app-wide or within a
<code>mailer</code> block.</p>

<pre class="highlight ruby"><code><span class="c1"># app/app.rb</span>
<span class="c1"># Application-wide mailer defaults</span>
<span class="n">set</span> <span class="ss">:mailer_defaults</span><span class="p">,</span> <span class="ss">:from</span> <span class="o">=&gt;</span> <span class="s1">'admin@site.com'</span>

<span class="c1"># app/mailers/sample_mailer.rb</span>
<span class="no">MyAppName</span><span class="p">.</span><span class="nf">mailers</span> <span class="ss">:sample</span> <span class="k">do</span>
  <span class="n">defaults</span> <span class="ss">:content_type</span> <span class="o">=&gt;</span> <span class="s1">'html'</span>
  <span class="n">email</span> <span class="ss">:registration</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">age</span><span class="o">|</span>
    <span class="c1"># Uses default 'content_type' and 'from' values but can also overwrite them</span>
    <span class="n">to</span>      <span class="s1">'user@domain.com'</span>
    <span class="n">subject</span> <span class="s1">'Welcome to the site!'</span>
    <span class="n">locals</span>  <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="nb">name</span>
    <span class="n">render</span>  <span class="s1">'sample/registration'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Using defaults makes sending email even easier when certain attributes are
repeated between messages.</p>

<hr />

<h2 id="rendering-variations">Rendering Variations</h2>

<p>To render a short body inline:</p>

<pre class="highlight ruby"><code><span class="c1"># app/mailers/sample_mailer.rb</span>
<span class="n">mailer</span> <span class="ss">:sample</span> <span class="k">do</span>
  <span class="n">email</span> <span class="ss">:short_email</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">user</span><span class="o">|</span>
    <span class="c1"># ...</span>
    <span class="n">body</span> <span class="s2">"This is a short body defined right in the mailer itself"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>To render a different template:</p>

<pre class="highlight ruby"><code><span class="c1"># app/mailers/sample_mailer.rb</span>
<span class="n">mailer</span> <span class="ss">:sample</span> <span class="k">do</span>
  <span class="n">email</span> <span class="ss">:custom_email</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">user</span><span class="o">|</span>
    <span class="c1"># ...</span>
    <span class="n">render</span><span class="p">(</span><span class="s1">'path/to/template'</span><span class="p">)</span> <span class="c1"># relative to views_path/mailers</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p class="excerpt"><a class="button" href="/guides/padrino-cache">Next Section – Padrino Cache</a></p>
</div></div></div><hr /><footer class="footer"><p>Padrino is released under the MIT LICENSE<br />
Hosting by <a href="https://pages.github.com">GitHub Pages</a></p>
</footer><script src="../../assets/javascripts/all-c2e0cecd.js"></script></div></body></html>