<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="initial-scale=1" name="viewport" /><title>Padrino - Rake Tasks</title><link href="/assets/favicon.ico" rel="icon" type="image/ico" /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" /><link href="../../assets/stylesheets/style-75d468d0.css" rel="stylesheet" /></head><body class="guides guides_rake-tasks guides_rake-tasks_index"><div class="grid"><header class="header"><h1 class="header__name"><a class="padrino-name" href="/">Padrino</a></h1><div class="header__navigation"><nav class="navigation"><a class="navigation__toggler" href="#" id="navigation__toggler"><span class="navigation__toggler__icon fa fa-navicon"></span></a><ul class="navigation__items" id="navigation__items"><li class="navigation__item"><a class="navigation__link" href="/">Overview</a></li><li class="navigation__item"><a class="navigation__link--is-active" href="/guides/">Guides</a></li><li class="navigation__item"><a class="navigation__link" href="/blog/">Blog</a></li><li class="navigation__item"><a class="navigation__link" href="http://www.rubydoc.info/github/padrino/padrino-framework">API</a></li><li class="navigation__item"><a class="navigation__link" href="/contribute/">Contribute</a></li><li class="navigation__item"><a class="navigation__link" href="https://github.com/padrino/padrino-framework"><span class="button--slim">GitHub</span></a></li></ul></nav></div></header><div class="page"><div class="page__sidebar"><div class="sidebar"><h4 class="sidebar__header--first">Guides</h4><ul class="sidebar__items"><li class="sidebar__item"><a class="sidebar__link" href="/guides/">Home</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/getting-started/">Getting Started</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/installation/">Installation</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/basic-projects/">Basic Projects</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/generators/">Generators</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/development-commands/">Development Commands</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/mounting-applications/">Mounting Applications</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/blog-tutorial/">Blog Tutorial</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/application-helpers/">Application Helpers</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/padrino-admin/">Padrino Admin</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/padrino-mailer/">Padrino Mailer</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/padrino-cache/">Padrino Cache</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/controllers/">Controllers</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/localization/">Localization</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/extensions/">Extensions</a></li><li class="sidebar__item"><a class="sidebar__link--is-active" href="/guides/rake-tasks/">Rake Tasks</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/the-bleeding-edge/">The Bleeding Edge</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/adding-new-components/">Adding New Components</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/standalone-usage-in-sinatra/">Standalone Usage in Sinatra</a></li><li class="sidebar__item"><a class="sidebar__link" href="/guides/running-padrino-on-jruby/">Running Padrino on JRuby</a></li></ul></div></div><div class="page__content"><div class="content"><h1 id="rake-tasks">Rake Tasks</h1>

<p>After generating a new padrino project, you will not find any Rakefile in your
generated project folder structure; in fact it‘s not strictly needed to build a
new one because we can already use padrino rake:</p>

<pre class="highlight shell"><code>padrino rake
<span class="c"># or for a list of tasks</span>
padrino rake -T
</code></pre>

<p>If you need custom tasks you can add those to:</p>

<ul>
  <li><em>your_project</em>/<strong>lib/tasks</strong></li>
  <li><em>your_project</em>/<strong>tasks</strong></li>
  <li><em>your_project</em>/<strong>test</strong></li>
  <li><em>your_project</em>/<strong>spec</strong></li>
</ul>

<p>Padrino will look recursively for any <code>*.rake</code> file in any of these directories.</p>

<p>Padrino by default has some useful tasks.</p>

<hr />

<h2 id="basic">Basic</h2>

<p>Like other frameworks we have an <em>:environment</em> task that loads our
<code>environment</code> and <code>apps</code>. Example:</p>

<pre class="highlight ruby"><code><span class="c1"># This is a custom task</span>
<span class="c1"># task/version.rake</span>
<span class="n">task</span> <span class="ss">:version</span> <span class="o">=&gt;</span> <span class="ss">:environment</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="no">Padrino</span><span class="p">.</span><span class="nf">version</span>
<span class="k">end</span>
</code></pre>

<hr />

<h2 id="routes">Routes</h2>

<p><em>currently not in stable release (coming in 0.9.10)</em></p>

<p>We have support for retrieving a list of named routes within your application
for easy access.</p>

<pre class="highlight shell"><code>padrino rake routes
</code></pre>

<p>which will return all the named routes for your project:</p>

<pre class="highlight shell"><code>Application: core
                 URL  REQUEST  PATH
  <span class="o">(</span>:guides, :search<span class="o">)</span>    GET    /guides/search
   <span class="o">(</span>:guides, :index<span class="o">)</span>    GET    /guides
    <span class="o">(</span>:guides, :show<span class="o">)</span>    GET    /guides/:id

Application: foo
     <span class="o">(</span>:blog, :index<span class="o">)</span>    GET    /blog
      <span class="o">(</span>:blog, :show<span class="o">)</span>    GET    /blog/:id
</code></pre>

<hr />

<h2 id="testing">Testing</h2>

<p>When testing with Padrino you have a built-in <code>padrino rake test</code> or for rspec
<code>padrino rake spec</code>.</p>

<pre class="highlight shell"><code>padrino rake <span class="nb">test</span> <span class="c"># =&gt; for bacon, riot, shoulda</span>
padrino rake spec <span class="c"># =&gt; for rspec</span>
</code></pre>

<p>you can customize <em>test/test.rake</em> or <em>spec/spec.rake</em></p>

<hr />

<h2 id="i18n">I18n</h2>

<p>You can auto generate a <em>yml</em> file for localizing your models using this
command:</p>

<pre class="highlight shell"><code>padrino rake locale:models
</code></pre>

<p>See <a href="/guides/localization">Localization</a> for detailed instructions.</p>

<hr />

<h2 id="orm">ORM</h2>

<p>Padrino has rake tasks for <em>DataMapper</em> , <em>ActiveRecord</em>, <em>Sequel</em>,
<em>Mongomapper</em>,and <em>Mongoid</em> with some <strong>bonuses</strong>.</p>

<p><strong>NOTE</strong>: we have a <strong>namespace</strong> for each orm, because of this, Padrino can
mount several applications and each of them can use different orms without
conflict, so that you can have multiple applications living together and one
of them can use DataMapper, while another
<code>ActiveRecord/MongoMapper/Couch/Sequel</code> instead. In this way we prevent
collisions.</p>

<hr />

<h2 id="activerecord-tasks">ActiveRecord Tasks:</h2>

<pre class="highlight shell"><code>rake ar:abort_if_pending_migrations    <span class="c"># Raises an error if there are pending migrations.</span>
rake ar:auto:upgrade                   <span class="c"># Uses schema.rb to auto-upgrade.</span>
rake ar:charset                        <span class="c"># Retrieves database charset.</span>
rake ar:collation                      <span class="c"># Retrieves databsae collation.</span>
rake ar:create                         <span class="c"># Creates the database as defined in config/database.yml</span>
rake ar:create:all                     <span class="c"># Creates local databases as defined in config/database.yml</span>
rake ar:drop                           <span class="c"># Drops the database for the current Padrino.env</span>
rake ar:drop:all                       <span class="c"># Drops local databases defined in config/database.yml</span>
rake ar:forward                        <span class="c"># Pushes the schema to the next version.</span>
rake ar:migrate                        <span class="c"># Migrates the database through scripts in db/migrate.</span>
rake ar:migrate:down                   <span class="c"># Runs the "down" for a given migration VERSION.</span>
rake ar:migrate:redo                   <span class="c"># Rollbacks current migration and migrates up to version</span>
rake ar:migrate:reset                  <span class="c"># Resets your database using your migrations.</span>
rake ar:migrate:up                     <span class="c"># Runs the "up" for a given migration VERSION NUMBER</span>
rake ar:reset                          <span class="c"># Drops and recreates the database using db/schema.rb.</span>
rake ar:rollback                       <span class="c"># Rolls back the schema to previous schema version.</span>
rake ar:schema:dump                    <span class="c"># Creates a portable db/schema.rb file.</span>
rake ar:schema:load                    <span class="c"># Loads a schema.rb file into the database.</span>
rake ar:schema:to_migration            <span class="c"># Creates a migration from schema.rb</span>
rake ar:schema:to_migration_with_reset <span class="c"># Creates a migration and resets the migrations log.</span>
rake ar:setup                          <span class="c"># Creates the database, loads the schema, and seeds data.</span>
rake ar:structure:dump                 <span class="c"># Dumps the database structure to a SQL file.</span>
rake ar:version                        <span class="c"># Retrieves the current schema version number.</span>
</code></pre>

<p><strong>rake ar:auto:upgrade</strong></p>

<p>This is some sort of super cool and useful task for people like me who don‘t
love migrations (especially for small apps). It‘s a forked version of
<a href="http://github.com/pjhyett/auto_migrations">auto_migrations</a>.</p>

<p>Basically, instead of writing migrations you can directly edit your
<strong>schema.rb</strong> and perform <em>a non destructive</em> migration with <code>padrino rake
ar:auto:upgrade</code>.</p>

<hr />

<h2 id="datamapper-tasks">DataMapper Tasks:</h2>

<pre class="highlight shell"><code>rake dm:auto:migrate          <span class="c"># Performs an automigration (resets your db data)</span>
rake dm:auto:upgrade          <span class="c"># Performs a non destructive automigration</span>
rake dm:create                <span class="c"># Creates the database</span>
rake dm:drop                  <span class="c"># Drops the database (postgres and mysql only)</span>
rake dm:migrate               <span class="c"># Migrates the database to the latest version</span>
rake dm:migrate:down[version] <span class="c"># Migrates down using migrations</span>
rake dm:migrate:up[version]   <span class="c"># Migrates up using migrations</span>
rake dm:reset                 <span class="c"># Drops the database, and migrates from scratch</span>
rake dm:setup                 <span class="c"># Create the database migrate and initialize with the seed data</span>
</code></pre>

<hr />

<h2 id="sequel-tasks">Sequel Tasks:</h2>

<pre class="highlight shell"><code>rake sq:migrate:auto        <span class="c"># Perform automigration (reset your db data)</span>
rake sq:migrate:to[version] <span class="c"># Perform migration up/down to VERSION</span>
rake sq:migrate:up          <span class="c"># Perform migration up to latest migration available</span>
rake sq:migrate:down        <span class="c"># Perform migration down (erase all data)</span>
rake sq:reset               <span class="c"># Drops the database, and migrates from scratch</span>
</code></pre>

<hr />

<h2 id="mongomapper-tasks">Mongomapper Tasks:</h2>

<pre class="highlight shell"><code>rake mm:translate              <span class="c"># Generates .yml files for I18n translations</span>
</code></pre>

<hr />

<h2 id="mongoid-tasks">Mongoid Tasks:</h2>

<p>Available in 0.9.21</p>

<pre class="highlight shell"><code>rake mi:drop                    <span class="c"># Drops all the collections for the database for the current environment</span>
rake mi:create_indexes          <span class="c"># Create the indexes defined on your mongoid models</span>
rake mi:objectid_convert        <span class="c"># Convert string objectids in mongo database to ObjectID type</span>
rake mi:cleanup_old_collections <span class="c"># Clean up old collections backed up by objectid_convert</span>
</code></pre>

<hr />

<h2 id="seed">Seed:</h2>

<p>Like in Rails we can populate our db using <em>db/seeds.rb</em> here‘s an example (from
our <a href="/guides/padrino-admin/">padrino-admin</a>):</p>

<pre class="highlight ruby"><code><span class="n">email</span>     <span class="o">=</span> <span class="n">shell</span><span class="p">.</span><span class="nf">ask</span> <span class="s2">"Which email do you want use for loggin into admin?"</span>
<span class="n">password</span>  <span class="o">=</span> <span class="n">shell</span><span class="p">.</span><span class="nf">ask</span> <span class="s2">"Tell me the password to use:"</span>

<span class="n">shell</span><span class="p">.</span><span class="nf">say</span> <span class="s2">""</span>

<span class="n">account</span> <span class="o">=</span> <span class="no">Account</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:email</span> <span class="o">=&gt;</span> <span class="n">email</span><span class="p">,</span> <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="n">password</span><span class="p">,</span>
                         <span class="ss">:password_confirmation</span> <span class="o">=&gt;</span> <span class="n">password</span><span class="p">,</span> <span class="ss">:role</span> <span class="o">=&gt;</span> <span class="s2">"admin"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">account</span><span class="p">.</span><span class="nf">valid?</span>
  <span class="n">shell</span><span class="p">.</span><span class="nf">say</span> <span class="s2">"Perfect! Your account was created."</span>
  <span class="n">shell</span><span class="p">.</span><span class="nf">say</span> <span class="s2">""</span>
  <span class="n">shell</span><span class="p">.</span><span class="nf">say</span> <span class="s2">"Now you can start your server with padrino start and then login into /admin with:"</span>
  <span class="n">shell</span><span class="p">.</span><span class="nf">say</span> <span class="s2">"   email: </span><span class="si">#{</span><span class="n">email</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">shell</span><span class="p">.</span><span class="nf">say</span> <span class="s2">"   password: </span><span class="si">#{</span><span class="n">password</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">shell</span><span class="p">.</span><span class="nf">say</span> <span class="s2">""</span>
  <span class="n">shell</span><span class="p">.</span><span class="nf">say</span> <span class="s2">"That's all!"</span>
<span class="k">else</span>
  <span class="n">shell</span><span class="p">.</span><span class="nf">say</span> <span class="s2">"Sorry but some thing went worng!"</span>
  <span class="n">shell</span><span class="p">.</span><span class="nf">say</span> <span class="s2">""</span>
  <span class="n">account</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="n">shell</span><span class="p">.</span><span class="nf">say</span> <span class="s2">"   - </span><span class="si">#{</span><span class="n">m</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>

<p class="excerpt"><a class="button" href="/guides/the-bleeding-edge">Next Section – The Bleeding Edge</a></p>
</div></div></div><hr /><footer class="footer"><p>Padrino is released under the MIT LICENSE<br />
Hosting by <a href="https://pages.github.com">GitHub Pages</a></p>
</footer><script src="../../assets/javascripts/all-c2e0cecd.js"></script></div></body></html>